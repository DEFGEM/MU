{% extends "base.html" %}

{% block title %}Dashboard - MU{% endblock %}

{% block content %}
<!-- Hero Section -->
<div class="bg-gradient-to-r from-primary to-charcoal text-white py-12">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <div class="text-center">
            <h1 class="text-3xl md:text-4xl lg:text-5xl font-serif font-bold mb-4">
                Bienvenido, <span class="text-accent">{{ username }}</span>
            </h1>
            <p class="text-lg md:text-xl text-gray-300 mb-6">
                Gestiona tus pagos y transacciones de forma segura
            </p>
            <div class="flex flex-col sm:flex-row gap-4 justify-center">
                <a href="{{ url_for('payment') }}"
                    class="bg-accent hover:bg-yellow-500 text-primary font-semibold px-6 md:px-8 py-3 rounded-lg transition-all duration-300 transform hover:scale-105">
                    <i class="fas fa-credit-card mr-2"></i>Realizar Pago
                </a>
                <a href="{{ url_for('history') }}"
                    class="border-2 border-white text-white hover:bg-white hover:text-primary font-semibold px-6 md:px-8 py-3 rounded-lg transition-all duration-300">
                    <i class="fas fa-history mr-2"></i>Ver Historial
                </a>
            </div>
        </div>
    </div>
</div>

<!-- Stats Section -->
<div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 md:gap-6">
        <!-- Total Transactions -->
        <div class="stat-card">
            <div class="flex items-center justify-between mb-3">
                <div class="flex-1 min-w-0">
                    <p class="text-slate text-xs md:text-sm font-medium mb-1">Total Transacciones</p>
                    <p class="text-2xl md:text-3xl font-bold text-primary truncate">{{ stats[0]|default('0') }}</p>
                </div>
                <div
                    class="w-10 h-10 md:w-12 md:h-12 bg-blue-100 rounded-lg flex items-center justify-center flex-shrink-0 ml-2">
                    <i class="fas fa-exchange-alt text-blue-600 text-lg md:text-xl"></i>
                </div>
            </div>
            <div class="flex items-center text-xs md:text-sm">
                <span class="text-green-600 font-medium">
                    <i class="fas fa-arrow-up mr-1"></i>+12.5%
                </span>
                <span class="text-slate ml-2">vs mes anterior</span>
            </div>
        </div>

        <!-- Total Amount -->
        <div class="stat-card">
            <div class="flex items-center justify-between mb-3">
                <div class="flex-1 min-w-0">
                    <p class="text-slate text-xs md:text-sm font-medium mb-1">Monto Total</p>
                    <p class="text-2xl md:text-3xl font-bold text-primary truncate">${{
                        "%.2f"|format(stats[1]|default(0)) }}</p>
                </div>
                <div
                    class="w-10 h-10 md:w-12 md:h-12 bg-green-100 rounded-lg flex items-center justify-center flex-shrink-0 ml-2">
                    <i class="fas fa-dollar-sign text-green-600 text-lg md:text-xl"></i>
                </div>
            </div>
            <div class="flex items-center text-xs md:text-sm">
                <span class="text-green-600 font-medium">
                    <i class="fas fa-arrow-up mr-1"></i>+8.2%
                </span>
                <span class="text-slate ml-2">vs mes anterior</span>
            </div>
        </div>

        <!-- Success Rate -->
        <div class="stat-card">
            <div class="flex items-center justify-between mb-3">
                <div class="flex-1 min-w-0">
                    <p class="text-slate text-xs md:text-sm font-medium mb-1">Tasa de Éxito</p>
                    <p class="text-2xl md:text-3xl font-bold text-primary truncate">98.5%</p>
                </div>
                <div
                    class="w-10 h-10 md:w-12 md:h-12 bg-green-100 rounded-lg flex items-center justify-center flex-shrink-0 ml-2">
                    <i class="fas fa-check-circle text-green-600 text-lg md:text-xl"></i>
                </div>
            </div>
            <div class="flex items-center text-xs md:text-sm">
                <span class="text-green-600 font-medium">
                    <i class="fas fa-arrow-up mr-1"></i>+2.1%
                </span>
                <span class="text-slate ml-2">vs mes anterior</span>
            </div>
        </div>

        <!-- Active Cards -->
        <div class="stat-card">
            <div class="flex items-center justify-between mb-3">
                <div class="flex-1 min-w-0">
                    <p class="text-slate text-xs md:text-sm font-medium mb-1">Tarjetas Activas</p>
                    <p class="text-2xl md:text-3xl font-bold text-primary truncate">7</p>
                </div>
                <div
                    class="w-10 h-10 md:w-12 md:h-12 bg-purple-100 rounded-lg flex items-center justify-center flex-shrink-0 ml-2">
                    <i class="fas fa-credit-card text-purple-600 text-lg md:text-xl"></i>
                </div>
            </div>
            <div class="flex items-center text-xs md:text-sm">
                <span class="text-slate">Tarjetas verificadas</span>
            </div>
        </div>
    </div>
</div>

<!-- Recent Transactions -->
<div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <div class="bg-white rounded-2xl shadow-lg border border-gray-200 overflow-hidden">
        <div class="px-4 md:px-6 py-4 border-b border-gray-200">
            <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-2">
                <h2 class="text-lg md:text-xl font-semibold text-primary">
                    <i class="fas fa-history text-accent mr-2"></i>
                    Transacciones Recientes
                </h2>
                <a href="{{ url_for('history') }}"
                    class="text-accent hover:text-yellow-500 font-medium text-sm transition-colors">
                    Ver todas <i class="fas fa-arrow-right ml-1"></i>
                </a>
            </div>
        </div>

        <div class="overflow-x-auto">
            <table class="w-full">
                <thead class="bg-gray-50">
                    <tr>
                        <th class="px-6 py-3 text-left text-xs font-medium text-slate uppercase tracking-wider">Folio
                        </th>
                        <th class="px-6 py-3 text-left text-xs font-medium text-slate uppercase tracking-wider">Monto
                        </th>
                        <th class="px-6 py-3 text-left text-xs font-medium text-slate uppercase tracking-wider">Tarjeta
                        </th>
                        <th class="px-6 py-3 text-left text-xs font-medium text-slate uppercase tracking-wider">Estado
                        </th>
                        <th class="px-6 py-3 text-left text-xs font-medium text-slate uppercase tracking-wider">Fecha
                        </th>
                        <th class="px-6 py-3 text-left text-xs font-medium text-slate uppercase tracking-wider">Acción
                        </th>
                    </tr>
                </thead>
                <tbody class="bg-white divide-y divide-gray-200">
                    {% for transaction in transactions %}
                    <tr class="hover:bg-gray-50 transition-colors">
                        <td class="px-6 py-4 whitespace-nowrap">
                            <div class="text-sm font-medium text-charcoal">{{ transaction[9]|default('N/A') }}</div>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap">
                            <div class="text-sm font-semibold text-primary">${{ "%.2f"|format(transaction[1]) }}</div>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap">
                            <div class="text-sm text-charcoal">
                                {% if transaction[11] %}
                                {{ transaction[11][:20] }}{% if transaction[11]|length > 20 %}...{% endif %}
                                {% else %}
                                <span class="text-slate">Tarjeta no registrada</span>
                                {% endif %}
                            </div>
                            <div class="text-xs text-slate">
                                **** **** **** {{ transaction[10][-4:] if transaction[10] else 'N/A' }}
                            </div>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap">
                            {% if transaction[2] == 'autorizado' %}
                            <span class="status-badge status-success">
                                <i class="fas fa-check-circle mr-1"></i>Autorizado
                            </span>
                            {% else %}
                            <span class="status-badge status-error">
                                <i class="fas fa-times-circle mr-1"></i>Rechazado
                            </span>
                            {% endif %}
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-slate">
                            {{ transaction[4] }}
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm">
                            <a href="{{ url_for('invoice', transaction_id=transaction[0]) }}"
                                class="text-accent hover:text-yellow-500 font-medium transition-colors">
                                <i class="fas fa-file-invoice mr-1"></i>Factura
                            </a>
                        </td>
                    </tr>
                    {% else %}
                    <tr>
                        <td colspan="6" class="px-6 py-12 text-center">
                            <div class="text-slate">
                                <i class="fas fa-inbox text-4xl mb-4 opacity-50"></i>
                                <p class="text-lg font-medium mb-2">No hay transacciones aún</p>
                                <p class="text-sm">Realiza tu primer pago para comenzar</p>
                            </div>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>

<!-- Quick Actions -->
<div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8 mb-8">
    <h2 class="text-xl md:text-2xl font-serif font-bold text-primary mb-6 text-center">Acciones Rápidas</h2>
    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4 md:gap-6">
        <!-- Make Payment -->
        <div class="action-card">
            <div class="w-16 h-16 bg-blue-100 rounded-2xl flex items-center justify-center mb-4 mx-auto">
                <i class="fas fa-credit-card text-blue-600 text-2xl"></i>
            </div>
            <h3 class="text-lg font-semibold text-primary mb-2">Realizar Pago</h3>
            <p class="text-slate text-sm mb-4">Procesa pagos seguros con múltiples métodos de pago</p>
            <a href="{{ url_for('payment') }}" class="btn-primary w-full">
                <i class="fas fa-arrow-right mr-2"></i>Comenzar
            </a>
        </div>

        <!-- View History -->
        <div class="action-card">
            <div class="w-16 h-16 bg-green-100 rounded-2xl flex items-center justify-center mb-4 mx-auto">
                <i class="fas fa-chart-line text-green-600 text-2xl"></i>
            </div>
            <h3 class="text-lg font-semibold text-primary mb-2">Ver Reportes</h3>
            <p class="text-slate text-sm mb-4">Consulta el historial detallado de todas tus transacciones</p>
            <a href="{{ url_for('history') }}" class="btn-secondary w-full">
                <i class="fas fa-history mr-2"></i>Ver Historial
            </a>
        </div>

        <!-- Generate Invoice -->
        <div class="action-card">
            <div class="w-16 h-16 bg-purple-100 rounded-2xl flex items-center justify-center mb-4 mx-auto">
                <i class="fas fa-file-invoice text-purple-600 text-2xl"></i>
            </div>
            <h3 class="text-lg font-semibold text-primary mb-2">Generar Factura</h3>
            <p class="text-slate text-sm mb-4">Crea facturas con datos fiscales para tus pagos</p>
            <a href="{{ url_for('payment') }}" class="btn-accent w-full">
                <i class="fas fa-receipt mr-2"></i>Nueva Factura
            </a>
        </div>
    </div>
</div>

<script>
    // Animate stats on load
    anime({
        targets: '.stat-card',
        translateY: [50, 0],
        opacity: [0, 1],
        duration: 800,
        delay: anime.stagger(100),
        easing: 'easeOutExpo'
    });

    // Animate action cards
    anime({
        targets: '.action-card',
        scale: [0.9, 1],
        opacity: [0, 1],
        duration: 600,
        delay: anime.stagger(150, { start: 400 }),
        easing: 'easeOutElastic(1, .8)'
    });

    // Counter animation for stats
    function animateCounter(element, target) {
        anime({
            targets: { count: 0 },
            count: target,
            duration: 2000,
            easing: 'easeOutExpo',
            update: function (anim) {
                element.textContent = Math.floor(anim.animatables[0].target.count);
            }
        });
    }

    // Animate counters when page loads
    document.addEventListener('DOMContentLoaded', function () {
        const statNumbers = document.querySelectorAll('.stat-card .text-3xl');
        statNumbers.forEach((stat, index) => {
            const target = parseInt(stat.textContent) || 0;
            if (target > 0) {
                setTimeout(() => animateCounter(stat, target), index * 200);
            }
        });
    });
</script>
{% endblock %}